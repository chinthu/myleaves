<div class="holidays-wrapper">
    <p-toast></p-toast>

    <div class="header">
        <div>
            <h2>Public Holidays {{selectedYear}}</h2>
            <p class="text-muted">Manage organization public holidays</p>
        </div>
        <div class="flex gap-3 align-items-center">
            <ng-select *ngIf="user?.role === 'SUPER_ADMIN'" [items]="organizations" [(ngModel)]="selectedOrgId"
                bindLabel="name" bindValue="id" (change)="onOrgChange()" placeholder="Select Organization"
                [style]="{width: '15rem'}">
            </ng-select>
            <ng-select [items]="years" [(ngModel)]="selectedYear" bindLabel="label" bindValue="value" (change)="onYearChange()"
                placeholder="Select Year" [style]="{width: '150px'}">
            </ng-select>
            <p-button *ngIf="canManage" label="Add Holiday" icon="pi pi-plus" (onClick)="openAddDialog()"></p-button>
        </div>
    </div>

    <div class="table-card">
        <p-table [value]="filteredHolidays" [loading]="loading" responsiveLayout="scroll" [scrollable]="true"
            scrollHeight="flex">
            <ng-template pTemplate="header">
                <tr>
                    <th>Date</th>
                    <th>Holiday Name</th>
                    <th>Type</th>
                    <th>Description</th>
                    <th *ngIf="canManage">Actions</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-holiday>
                <tr>
                    <td>
                        <div class="date-cell">
                            <div class="date-day">{{ holiday.date | date:'dd' }}</div>
                            <div class="date-month">{{ holiday.date | date:'MMM' }}</div>
                        </div>
                    </td>
                    <td>
                        <div class="font-medium">{{ holiday.name }}</div>
                        <div class="text-sm text-500">{{ holiday.date | date:'EEEE' }}</div>
                    </td>
                    <td>
                        <p-tag [value]="holiday.type" [severity]="getTypeSeverity(holiday.type)"></p-tag>
                    </td>
                    <td>{{ holiday.description || '-' }}</td>
                    <td *ngIf="canManage">
                        <div class="flex gap-2">
                            <p-button icon="pi pi-pencil" styleClass="p-button-rounded p-button-text"
                                (onClick)="openEditDialog(holiday)" pTooltip="Edit"></p-button>
                            <p-button icon="pi pi-trash" styleClass="p-button-rounded p-button-danger p-button-text"
                                (onClick)="deleteHoliday(holiday)" pTooltip="Delete"></p-button>
                        </div>
                    </td>
                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td [attr.colspan]="canManage ? 5 : 4" class="text-center p-4">
                        <div class="empty-state">
                            <i class="pi pi-calendar text-4xl mb-3 text-400"></i>
                            <p>No public holidays found for {{selectedYear}}</p>
                            <p-button *ngIf="canManage" label="Add First Holiday" icon="pi pi-plus"
                                (onClick)="openAddDialog()"></p-button>
                        </div>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</div>

<!-- Add/Edit Dialog -->
<p-dialog [(visible)]="showDialog" [header]="isEditing ? 'Edit Holiday' : 'Add Holiday'" [modal]="true"
    [style]="{width: '500px'}" [draggable]="false" [resizable]="false" appendTo="body">
    <div class="flex flex-column gap-3 p-3">
        <div class="flex flex-column gap-2">
            <label for="name" class="font-semibold">Holiday Name *</label>
            <input id="name" type="text" pInputText [(ngModel)]="currentHoliday.name"
                placeholder="e.g., Independence Day" />
        </div>

        <div class="flex flex-column gap-2">
            <label for="date" class="font-semibold">Date *</label>
            <p-calendar id="date" [(ngModel)]="currentHoliday.date" [showIcon]="true" dateFormat="dd/mm/yy"
                appendTo="body"></p-calendar>
        </div>

        <div class="flex flex-column gap-2">
            <label for="type" class="font-semibold">Type *</label>
            <ng-select id="type" [items]="holidayTypes" [(ngModel)]="currentHoliday.type" bindLabel="label"
                bindValue="value" [clearable]="true" placeholder="Select Type" appendTo="body"></ng-select>
        </div>

        <div class="flex flex-column gap-2">
            <label for="description" class="font-semibold">Description</label>
            <input id="description" pInputText [(ngModel)]="currentHoliday.description"
                placeholder="Optional description" />
        </div>
    </div>

    <ng-template pTemplate="footer">
        <p-button label="Cancel" icon="pi pi-times" (onClick)="closeDialog()" styleClass="p-button-text"></p-button>
        <p-button label="Save" icon="pi pi-check" (onClick)="saveHoliday()"></p-button>
    </ng-template>
</p-dialog>