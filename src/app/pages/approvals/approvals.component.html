<div class="approvals-wrapper">
    <p-toast></p-toast>

    <div *ngIf="loading" class="loading">Loading...</div>

    <div *ngIf="!loading && pendingLeaves.length === 0" class="empty-state">
        <p>No pending approvals found.</p>
    </div>

    <div *ngIf="!loading && pendingLeaves.length > 0">
        <div class="header">
            <h2>Pending Approvals</h2>
        </div>

        <div class="table-card">
            <div class="table-responsive">
                <p-table [value]="pendingLeaves" [rows]="10" [paginator]="true" responsiveLayout="scroll">
                    <ng-template pTemplate="header">
                        <tr>
                            <th>Employee</th>
                            <th>Type</th>
                            <th>Dates</th>
                            <th>Days</th>
                            <th>Reason</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-leave>
                        <tr>
                            <td>
                                <div class="font-medium">{{ leave.users?.full_name || leave.users?.email }}</div>
                            </td>
                            <td>{{ leave.type }}</td>
                            <td>
                                {{ leave.start_date | date }}
                                <span *ngIf="leave.start_date !== leave.end_date"> - {{ leave.end_date | date }}</span>
                                <div *ngIf="leave.is_half_day" class="text-sm text-500">
                                    {{ leave.half_day_slot === 'MORNING' ? 'First Half' : 'Second Half' }}
                                </div>
                            </td>
                            <td>{{ leave.days_count }}</td>
                            <td>{{ leave.reason }}</td>
                            <td>
                                <p-tag [value]="leave.status" [severity]="getSeverity(leave.status)"></p-tag>
                            </td>
                            <td>
                                <div class="flex gap-2">
                                    <p-button icon="pi pi-check"
                                        styleClass="p-button-rounded p-button-success p-button-text"
                                        (onClick)="updateStatus(leave.id, 'APPROVED')" pTooltip="Approve"></p-button>
                                    <p-button icon="pi pi-times"
                                        styleClass="p-button-rounded p-button-danger p-button-text"
                                        (onClick)="openRejectDialog(leave)" pTooltip="Reject"></p-button>
                                </div>
                            </td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="7" class="text-center p-4">No pending approvals found.</td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </div>
    </div>

    <!-- Reject Leave Dialog -->
    <p-dialog 
        [(visible)]="showRejectDialog" 
        [modal]="true" 
        [style]="{width: '500px'}" 
        [draggable]="false"
        [resizable]="false"
        header="Reject Leave"
        [closable]="true"
        (onHide)="closeRejectDialog()">
        <div class="flex flex-column gap-3">
            <div *ngIf="selectedLeave">
                <p><strong>Employee:</strong> {{ selectedLeave.users?.full_name || selectedLeave.users?.email }}</p>
                <p><strong>Leave Type:</strong> {{ selectedLeave.type }}</p>
                <p><strong>Dates:</strong> {{ selectedLeave.start_date | date }} - {{ selectedLeave.end_date | date }}</p>
            </div>
            <div>
                <label class="block mb-2">Rejection Reason <span class="text-red-500">*</span></label>
                <textarea 
                    [(ngModel)]="rejectionReason" 
                    pInputTextarea 
                    rows="4"
                    placeholder="Please provide a reason for rejecting this leave"
                    [style]="{width: '100%'}"
                    required></textarea>
            </div>
        </div>
        <ng-template pTemplate="footer">
            <p-button label="Cancel" icon="pi pi-times" (onClick)="closeRejectDialog()" styleClass="p-button-text"></p-button>
            <p-button label="Reject Leave" icon="pi pi-times" (onClick)="confirmReject()" styleClass="p-button-danger"></p-button>
        </ng-template>
    </p-dialog>
</div>